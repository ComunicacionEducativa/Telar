{"ast":null,"code":"const fs = require('./funcionesServidor.js');\n\nconst fichas = fs.crearFichas();\nvar VERBOSE = true; //Funciones para la puntuacion del juego\n\nfunction sacarFila(arr, idx) {\n  const ret = [];\n\n  for (const fil in arr) {\n    ret.push(arr[fil][idx]);\n  }\n\n  return ret;\n}\n\nfunction lensubconjunto(arr, ficha) {\n  var subconjunto = fs.clonar(ficha);\n  var subconjuntolen = 0;\n\n  for (var i = 0; i < arr.length; i++) {\n    var fichaComp = fichas[arr[i]];\n\n    if (fichaComp) {\n      if (subconjunto.includes(fichaComp[\"color\"])) {\n        subconjuntolen += 1;\n\n        if (!subconjunto.includes(fichaComp[\"patron\"])) {\n          subconjunto = [fichaComp[\"color\"]];\n        }\n      } else if (subconjunto.includes(fichaComp[\"patron\"])) {\n        subconjuntolen += 1;\n        subconjunto = [fichaComp[\"patron\"]];\n      } else {\n        break;\n      }\n    } else {\n      return [subconjuntolen, subconjunto];\n    }\n  }\n\n  return [subconjuntolen, subconjunto];\n}\n\nfunction subconjuntosVerticales(tablero, posiciones) {\n  var subconjuntos = [[], [], [], [], []];\n\n  for (const idx in posiciones) {\n    var pos = posiciones[idx];\n    var tab = tablero[pos[0]].slice(0, pos[1]);\n    const ficha = fichas[tablero[pos[0]][pos[1]]];\n    tab.reverse();\n    const subconjunto = lensubconjunto(tab, [ficha[\"color\"], ficha[\"patron\"]])[0];\n\n    if (subconjunto) {\n      subconjuntos[pos[0]] = [pos[1] - subconjunto, pos[1]];\n    }\n  }\n\n  return subconjuntos;\n} //TODO: CAREFULLY EXAMINE + REFACTOR THIS SPAGHETTI CODE\n\n\nfunction subconjuntosHorizontales(tablero, posiciones) {\n  var subconjuntos = [[], [], [], [], []];\n\n  for (const idx in posiciones) {\n    var pos = posiciones[idx];\n    const fila = sacarFila(tablero, pos[1]);\n    var visitado = false;\n\n    for (const sc in subconjuntos[pos[1]]) {\n      if (subconjuntos[pos[1]][sc][0] <= pos[0] && subconjuntos[pos[1]][sc][1] >= pos[0]) {\n        visitado = true;\n        break;\n      }\n    }\n\n    if (!visitado) {\n      const ficha = fichas[tablero[pos[0]][pos[1]]];\n      const tableroIzq = fila.slice(0, pos[0]);\n      tableroIzq.reverse();\n      var lenSubconjIzq = lensubconjunto(tableroIzq, [ficha[\"color\"], ficha[\"patron\"]]);\n\n      if (lenSubconjIzq[0]) {\n        subconjuntos[pos[1]].push([pos[0] - lenSubconjIzq[0], pos[0]]);\n      } // Lado derecho\n\n\n      var derecho = [];\n      const tableroDer = fila.slice(pos[0] + 1, fila.length);\n\n      if (pos[0] != tablero[0].length - 1) {\n        var adjacent = fichas[tablero[pos[0] + 1][pos[1]]];\n\n        if (adjacent) {\n          if (lenSubconjIzq[1].includes(adjacent[\"color\"]) || lenSubconjIzq[1].includes(adjacent[\"patron\"])) {\n            derecho = lenSubconjIzq[1];\n            var subconjuntoDer = lensubconjunto(tableroDer, derecho)[0];\n\n            if (subconjuntoDer) {\n              if (subconjuntos[pos[1]].length > 0) {\n                subconjuntos[pos[1]][subconjuntos[pos[1]].length - 1][1] += subconjuntoDer;\n              } else {\n                subconjuntos[pos[1]].push([pos[0], pos[0] + subconjuntoDer]);\n              }\n            }\n          } else {\n            var derecho = [ficha[\"color\"], ficha[\"patron\"]];\n\n            if (derecho.includes(adjacent[\"color\"]) || derecho.includes(adjacent[\"patron\"])) {\n              var subconjuntoDer = lensubconjunto(tableroDer, derecho)[0];\n\n              if (subconjuntoDer) {\n                subconjuntos[pos[1]].push([pos[0], pos[0] + lensubconjunto(tableroDer, derecho)[0]]);\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return subconjuntos;\n} //Funcion para bajar filas al finar de una ronda\n\n\nfunction bajarFichas(tablero, posiciones) {\n  var newTablero = fs.clonar(tablero);\n\n  for (const pos in posiciones) {\n    for (const col in newTablero[pos]) {\n      if (newTablero[pos][col] === null) {\n        newTablero[pos][col] = posiciones[pos];\n        break;\n      }\n    }\n  }\n\n  return newTablero;\n}\n\nfunction calcularPuntos(jugador, posiciones, basura) {\n  var subconjuntos = [[], []];\n  var puntuacionV = 0;\n  var puntuacionH = 0;\n  subconjuntos[0] = subconjuntosVerticales(jugador[\"tablero\"], posiciones);\n\n  for (var sc in subconjuntos[0]) {\n    if (subconjuntos[0][sc].length) {\n      puntuacionV += 1 + subconjuntos[0][sc][1] - subconjuntos[0][sc][0];\n    }\n  }\n\n  subconjuntos[1] = subconjuntosHorizontales(jugador[\"tablero\"], posiciones);\n\n  for (var sc in subconjuntos[1]) {\n    for (var ssc in subconjuntos[1][sc]) {\n      if (subconjuntos[1][sc][ssc].length) {\n        puntuacionH += 1 + subconjuntos[1][sc][ssc][1] - subconjuntos[1][sc][ssc][0];\n      }\n    }\n  }\n\n  return [puntuacionH + puntuacionV - basura, subconjuntos];\n}\n\nfunction bajarFichasYSacarPuntuacion(salaActual, state) {\n  let socket = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : \"\";\n\n  if (VERBOSE) {\n    console.log(\"Bajando las fichas en la sala. Canastas en la sala:\");\n\n    for (const u in salaActual[\"usuarios\"]) {\n      console.log(`${salaActual[\"usuarios\"][u][\"canasta\"]}`);\n    }\n  }\n\n  if (!salaActual[\"primerTurno\"] || salaActual[\"local\"]) {\n    //como primerTurno solo es para prevenir requests multiples, siempre es falso en salas locales\n    salaActual[\"primerTurno\"] = false; //Manejo de cada usuario en la sala \n\n    for (const u in salaActual[\"usuarios\"]) {\n      var usuarioActual = salaActual[\"usuarios\"][u];\n\n      if (usuarioActual[\"usuario\"] == socket.id || salaActual[\"canasta\"]) {\n        usuarioActual[\"canasta\"] = [];\n        usuarioActual[\"columnas\"] = state[\"cols\"];\n        usuarioActual[\"basura\"] = state[\"basura\"];\n      } // Bajar fichas y sacar puntuacion\n\n\n      var fichasBajadas = [];\n      var nuevoTablero = fs.clonar(usuarioActual[\"tablero\"]);\n\n      for (const c in usuarioActual[\"columnas\"]) {\n        var colActual = usuarioActual[\"columnas\"][c];\n\n        if (colActual[colActual.length - 1] != null) {\n          //si esta llena la columna\n          usuarioActual[\"columnas\"][c] = Array(colActual.length).fill(null); // Se borra la columna \n\n          if (colActual.length > 1) {\n            //Se regresan las fichas de mas\n            salaActual[\"fichasCentro\"] = salaActual[\"fichasCentro\"].concat(fs.indexesToFichas(colActual.slice(1), salaActual[\"fichas\"]));\n          }\n\n          for (const f in nuevoTablero[c]) {\n            // Se bajan las fichas \n            if (nuevoTablero[c][f] === null) {\n              nuevoTablero[c][f] = colActual[0];\n              fichasBajadas.push([parseInt(c), parseInt(f)]);\n\n              if (f == nuevoTablero[c].length - 1) {\n                salaActual[\"activo\"] = false;\n              }\n\n              break;\n            }\n          }\n        }\n      }\n\n      usuarioActual[\"tablero\"] = nuevoTablero;\n      const puntos = calcularPuntos(usuarioActual, fichasBajadas, usuarioActual[\"basura\"].length);\n      usuarioActual[\"puntuacion\"][0] += puntos[0];\n      usuarioActual[\"puntuacion\"][1] = puntos[1];\n      salaActual[\"fichasCentro\"] = salaActual[\"fichasCentro\"].concat(fs.indexesToFichas(usuarioActual[\"basura\"], salaActual[\"fichas\"]));\n      usuarioActual[\"basura\"] = [];\n    }\n\n    salaActual[\"ronda\"] += 1;\n    var primerJugador = salaActual[\"ronda\"] % salaActual[\"usuarios\"].length;\n    salaActual[\"turno\"] = salaActual[\"usuarios\"][primerJugador][\"usuario\"];\n\n    if (VERBOSE) {\n      console.log(\"Distribuyendo fichas. Sala antes de distribuir:\");\n\n      for (const u in salaActual[\"usuarios\"]) {\n        console.log(salaActual[\"usuarios\"][u][\"canasta\"]);\n      }\n    }\n\n    fs.distribuirFichas(salaActual, primerJugador);\n\n    if (VERBOSE) {\n      console.log(\"Se distrubyeron las fichas. Sala:\");\n\n      for (const u in salaActual[\"usuarios\"]) {\n        console.log(salaActual[\"usuarios\"][u][\"canasta\"]);\n      }\n    }\n\n    return salaActual;\n  } else {\n    console.log(`ERROR: Ya empezo la siguiente ronda en la sala ${salaActual[\"sala\"]}`);\n  }\n}\n\nmodule.exports = {\n  calcularPuntos,\n  bajarFichas,\n  bajarFichasYSacarPuntuacion\n};","map":{"version":3,"names":["fs","require","fichas","crearFichas","VERBOSE","sacarFila","arr","idx","ret","fil","push","lensubconjunto","ficha","subconjunto","clonar","subconjuntolen","i","length","fichaComp","includes","subconjuntosVerticales","tablero","posiciones","subconjuntos","pos","tab","slice","reverse","subconjuntosHorizontales","fila","visitado","sc","tableroIzq","lenSubconjIzq","derecho","tableroDer","adjacent","subconjuntoDer","bajarFichas","newTablero","col","calcularPuntos","jugador","basura","puntuacionV","puntuacionH","ssc","bajarFichasYSacarPuntuacion","salaActual","state","socket","console","log","u","usuarioActual","id","fichasBajadas","nuevoTablero","c","colActual","Array","fill","concat","indexesToFichas","f","parseInt","puntos","primerJugador","distribuirFichas","module","exports"],"sources":["/home/csgarciamartinez/Telar/telar-client/src/server/puntuacion.js"],"sourcesContent":["const fs = require('./funcionesServidor.js');\n\n\nconst fichas =fs.crearFichas();\nvar VERBOSE=true\n\n//Funciones para la puntuacion del juego\nfunction sacarFila(arr, idx){\n\tconst ret = []\n\tfor(const fil in arr){\n\t\tret.push(arr[fil][idx])\n\t}\n\treturn ret\n}\n\nfunction lensubconjunto(arr, ficha){\n\tvar subconjunto = fs.clonar(ficha)\n\tvar subconjuntolen = 0 \n\tfor(var i = 0; i < arr.length; i++){\n\t\tvar fichaComp = fichas[arr[i]]\n\t\tif(fichaComp){\n\t\t\tif(subconjunto.includes(fichaComp[\"color\"])){\n\t\t\t\tsubconjuntolen += 1\n\t\t\t\tif(!subconjunto.includes(fichaComp[\"patron\"])){\n\t\t\t\t\tsubconjunto = [fichaComp[\"color\"]]\n\t\t\t\t}\n\t\t\t} else if(subconjunto.includes(fichaComp[\"patron\"])) {\n\t\t\t\tsubconjuntolen += 1\n\t\t\t\tsubconjunto = [fichaComp[\"patron\"]]\n\t\t\t} else {\n\t\t\t\tbreak\n\t\t\t}\n\t\t} else {\n\t\t\treturn [subconjuntolen, subconjunto]\n\t\t}\n\t}\n\treturn [subconjuntolen, subconjunto]\n}\n\nfunction subconjuntosVerticales(tablero, posiciones){\n\tvar subconjuntos = [[], [], [], [], []]\n\tfor(const idx in posiciones){\n\t\tvar pos = posiciones[idx]\n\t\tvar tab = tablero[pos[0]].slice(0, pos[1])\n\t\tconst ficha = fichas[tablero[pos[0]][pos[1]]]\n\t\ttab.reverse()\n\t\tconst subconjunto = lensubconjunto(tab, [ficha[\"color\"], ficha[\"patron\"]])[0]\n\t\tif(subconjunto){\n\t\t\tsubconjuntos[pos[0]] = [pos[1] - subconjunto, pos[1]]\n\t\t}\n\t}\n\treturn subconjuntos\n}\n\n\n//TODO: CAREFULLY EXAMINE + REFACTOR THIS SPAGHETTI CODE\n\nfunction subconjuntosHorizontales(tablero, posiciones){\n\tvar subconjuntos = [[], [], [], [], []]\n\tfor(const idx in posiciones){\n\t\tvar pos = posiciones[idx] \n\t\tconst fila = sacarFila(tablero, pos[1])\n\t\tvar visitado = false\n\t\tfor(const sc in subconjuntos[pos[1]]){\n\t\t\tif(subconjuntos[pos[1]][sc][0] <= pos[0]\n\t\t\t\t&& subconjuntos[pos[1]][sc][1] >= pos[0]){\n\t\t\t\tvisitado = true\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\tif(!visitado){\n\t\t\tconst ficha = fichas[tablero[pos[0]][pos[1]]]\n\t\t\tconst tableroIzq = fila.slice(0, pos[0])\n\t\t\ttableroIzq.reverse()\n\t\t\tvar lenSubconjIzq = lensubconjunto(tableroIzq, [ficha[\"color\"], ficha[\"patron\"]])\n\t\t\tif(lenSubconjIzq[0]){\n\t\t\t\tsubconjuntos[pos[1]].push([pos[0] - lenSubconjIzq[0], pos[0]])\n\t\t\t}\n\t\t\t// Lado derecho\n\t\t\tvar derecho = []\n\t\t\tconst tableroDer = fila.slice(pos[0]+1, fila.length)\n\t\t\tif(pos[0] != tablero[0].length - 1){\n\t\t\t\tvar adjacent = fichas[tablero[pos[0]+1][pos[1]]]\n\t\t\t\tif (adjacent){\n\t\t\t\t\tif(lenSubconjIzq[1].includes(adjacent[\"color\"]) || lenSubconjIzq[1].includes(adjacent[\"patron\"])) {\n\t\t\t\t\t\tderecho = lenSubconjIzq[1]\n\t\t\t\t\t\tvar subconjuntoDer = lensubconjunto(tableroDer, derecho)[0]\n\t\t\t\t\t\tif(subconjuntoDer){\n\t\t\t\t\t\t\tif(subconjuntos[pos[1]].length > 0 ){\n\t\t\t\t\t\t\t\tsubconjuntos[pos[1]][subconjuntos[pos[1]].length - 1][1] += subconjuntoDer\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsubconjuntos[pos[1]].push([pos[0], pos[0] + subconjuntoDer])\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar derecho = [ficha[\"color\"], ficha[\"patron\"]]\n\t\t\t\t\t\tif(derecho.includes(adjacent[\"color\"]) || derecho.includes(adjacent[\"patron\"])) {\n\t\t\t\t\t\t\tvar subconjuntoDer = lensubconjunto(tableroDer, derecho)[0]\n\t\t\t\t\t\t\tif(subconjuntoDer){\n\t\t\t\t\t\t\t\tsubconjuntos[pos[1]].push([pos[0], pos[0] + lensubconjunto(tableroDer, derecho)[0]])\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn subconjuntos\n}\n\n\n\n//Funcion para bajar filas al finar de una ronda\nfunction bajarFichas(tablero, posiciones){\n\tvar newTablero = fs.clonar(tablero)\n\tfor(const pos in posiciones){\n\t\tfor(const col in newTablero[pos]){\n\t\t\tif(newTablero[pos][col] === null){\n\t\t\t\tnewTablero[pos][col] = posiciones[pos]\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\treturn newTablero\n}\n\n\n\n\nfunction calcularPuntos(jugador, posiciones, basura){\n\tvar subconjuntos = [[], []]\n\tvar puntuacionV = 0\n\tvar puntuacionH = 0\n\tsubconjuntos[0] = subconjuntosVerticales(jugador[\"tablero\"], posiciones)\n\tfor(var sc in subconjuntos[0]){\n\t\tif(subconjuntos[0][sc].length){\n\t\t\tpuntuacionV += 1 + subconjuntos[0][sc][1] - subconjuntos[0][sc][0]\n\t\t}\n\t}\n\tsubconjuntos[1] = subconjuntosHorizontales(jugador[\"tablero\"], posiciones)\n\tfor(var sc in subconjuntos[1]){\n\t\tfor(var ssc in subconjuntos[1][sc]){\n\t\t\tif(subconjuntos[1][sc][ssc].length){\n\t\t\t\tpuntuacionH += 1 + subconjuntos[1][sc][ssc][1] - subconjuntos[1][sc][ssc][0]\n\t\t\t}\n\t\t}\n\t}\n\n\treturn [puntuacionH+puntuacionV-basura, subconjuntos]\n}\n\n\n\n\nfunction bajarFichasYSacarPuntuacion(salaActual, state, socket = \"\"){\n\tif(VERBOSE){\n\t\tconsole.log(\"Bajando las fichas en la sala. Canastas en la sala:\")\n\t\tfor(const u in salaActual[\"usuarios\"]){\n\t\t\tconsole.log(`${salaActual[\"usuarios\"][u][\"canasta\"]}`)\n\t\t}\n\t}\n\tif(!salaActual[\"primerTurno\"] || salaActual[\"local\"]){ //como primerTurno solo es para prevenir requests multiples, siempre es falso en salas locales\n  \t\t\tsalaActual[\"primerTurno\"] = false;\n\n  \t\t\t//Manejo de cada usuario en la sala \n\t  \t\tfor(const u in salaActual[\"usuarios\"]){\n\t  \t\t\tvar usuarioActual = salaActual[\"usuarios\"][u]\n\t  \t\t\tif(usuarioActual[\"usuario\"] == socket.id || salaActual[\"canasta\"]){\n\t\t\t  \t\tusuarioActual[\"canasta\"] = []\n\t\t\t  \t\tusuarioActual[\"columnas\"] = state[\"cols\"]\n\t\t\t  \t\tusuarioActual[\"basura\"] = state[\"basura\"]\n\t  \t\t\t}\n\n\t  \t\t\t// Bajar fichas y sacar puntuacion\n\t  \t\t\tvar fichasBajadas = []\n\t  \t\t\tvar nuevoTablero = fs.clonar(usuarioActual[\"tablero\"])\n\t  \t\t\tfor(const c in usuarioActual[\"columnas\"]){\n\t  \t\t\t\tvar colActual = usuarioActual[\"columnas\"][c]\n\t  \t\t\t\tif(colActual[colActual.length - 1] != null){ //si esta llena la columna\n\t  \t\t\t\t\tusuarioActual[\"columnas\"][c] = Array(colActual.length).fill(null) // Se borra la columna \n\t  \t\t\t\t\tif(colActual.length > 1){ //Se regresan las fichas de mas\n\t\t\t  \t\t\t\tsalaActual[\"fichasCentro\"] = salaActual[\"fichasCentro\"].concat(fs.indexesToFichas(colActual.slice(1), salaActual[\"fichas\"]))\n\t\t\t  \t\t\t}\n\t\t  \t\t\t\tfor(const f in nuevoTablero[c]){ // Se bajan las fichas \n\t\t  \t\t\t\t\tif(nuevoTablero[c][f] === null){\n\t\t\t\t\t\t\t\t\tnuevoTablero[c][f] = colActual[0]\n\t\t\t\t\t\t\t\t\tfichasBajadas.push([parseInt(c), parseInt(f)])\n\t\t\t\t\t\t\t\t\tif(f == nuevoTablero[c].length-1){\n\t\t  \t\t\t\t\t\t\tsalaActual[\"activo\"] = false\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t}\n\t\t  \t\t\t\t}\n\t\t  \t\t\t} \n\t  \t\t\t}\n\t  \t\t\tusuarioActual[\"tablero\"] = nuevoTablero\n\t  \t\t\tconst puntos = calcularPuntos(usuarioActual, fichasBajadas, usuarioActual[\"basura\"].length)\n\t  \t\t\tusuarioActual[\"puntuacion\"][0] += puntos[0]\n\t  \t\t\tusuarioActual[\"puntuacion\"][1] = puntos[1]\n\t  \t\t\tsalaActual[\"fichasCentro\"] = salaActual[\"fichasCentro\"].concat(fs.indexesToFichas(usuarioActual[\"basura\"], salaActual[\"fichas\"]))\n\t  \t\t\tusuarioActual[\"basura\"] = []\n\t  \t\t}\n\t  \t\tsalaActual[\"ronda\"] += 1\n\t  \t\tvar primerJugador = salaActual[\"ronda\"]%salaActual[\"usuarios\"].length\n\t  \t\tsalaActual[\"turno\"] = salaActual[\"usuarios\"][primerJugador][\"usuario\"]\n\t  \t\tif(VERBOSE){\n\t  \t\t\tconsole.log(\"Distribuyendo fichas. Sala antes de distribuir:\")\n\t  \t\t\tfor(const u in salaActual[\"usuarios\"]){\n\t\t\t\t\tconsole.log(salaActual[\"usuarios\"][u][\"canasta\"])\n\t\t\t\t}\n\t  \t\t}\n\t  \t\tfs.distribuirFichas(salaActual, primerJugador)\n\t  \t\tif(VERBOSE){\n\t  \t\t\tconsole.log(\"Se distrubyeron las fichas. Sala:\")\n\t  \t\t\tfor(const u in salaActual[\"usuarios\"]){\n\t\t\t\t\tconsole.log(salaActual[\"usuarios\"][u][\"canasta\"])\n\t\t\t\t}\n\t  \t\t}\n\t  \t\treturn salaActual\n\t  \t} else {\n\t  \t\tconsole.log(`ERROR: Ya empezo la siguiente ronda en la sala ${salaActual[\"sala\"]}`)\n\t  \t}\n}\n\nmodule.exports = {calcularPuntos, bajarFichas, bajarFichasYSacarPuntuacion};"],"mappings":"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"},"metadata":{},"sourceType":"module"}